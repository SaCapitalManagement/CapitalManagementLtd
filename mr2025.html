<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>New MR 2025 vs SPY Benchmark</title>
  <meta name="viewport" content="width=900, initial-scale=1">
</head>
<body>
  <div style="max-width:900px; margin:auto; font-family:sans-serif;">
    <div id="newmrChart" style="height:400px;"></div>
    <div id="statsPanel" style="margin-top:20px; font-size:15px; line-height:1.6;"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
  <script>
    async function drawChartAndStats() {
      const newmrUrl = "https://raw.githubusercontent.com/SaCapitalManagement/CapitalManagementLtd/main/public_json/newmr2025.json";
      const spyUrl = "https://raw.githubusercontent.com/SaCapitalManagement/CapitalManagementLtd/main/public_json/spybenchmark.json";
      const statsUrl = "https://raw.githubusercontent.com/SaCapitalManagement/CapitalManagementLtd/refs/heads/main/public_json/newmr2025t_stats.json";

      const [newmrData, spyData, stats] = await Promise.all([
        fetch(newmrUrl).then(res => res.json()),
        fetch(spyUrl).then(res => res.json()),
        fetch(statsUrl).then(res => res.json())
      ]);

      const filterValid = data => data.filter(d => d.Equity && !isNaN(d.Equity));
      const newmrMap = new Map(filterValid(newmrData).map(d => [d.Date, parseFloat(d.Equity)]));
      const spyMap = new Map(filterValid(spyData).map(d => [d.Date, parseFloat(d.Equity)]));
      const allDates = Array.from(new Set([...newmrMap.keys(), ...spyMap.keys()])).sort((a, b) => new Date(a) - new Date(b));
      const newmrEquity = allDates.map(date => newmrMap.get(date) ?? null);
      const spyEquity = allDates.map(date => spyMap.get(date) ?? null);

      const chartDom = document.getElementById('newmrChart');
      const myChart = echarts.init(chartDom);
      myChart.setOption({
        title: {
          text: 'New MR 2025 vs SPY Benchmark',
          left: 'center'
        },
        tooltip: {
          trigger: 'axis',
          formatter: params => {
            return params.map(p => `${p.seriesName}: $${p.value?.toLocaleString(undefined, { maximumFractionDigits: 2 }) || 'n/a'}`).join('<br/>') +
                   `<br/>Date: ${params[0].axisValue}`;
          }
        },
        legend: {
          top: 30,
          data: ['New MR 2025', 'SPY Benchmark']
        },
        xAxis: {
          type: 'category',
          data: allDates,
          name: 'Year',
          axisLabel: {
            formatter: function (value) {
              // For "YYYY-MM-DD" format (GitHub JSON usually uses this)
              if (/^\d{4}-\d{2}-\d{2}$/.test(value)) {
                return value.slice(2, 4); // "23" for "2023-06-30"
              }
              // For "MM/DD/YY"
              if (/^\d{2}\/\d{2}\/\d{2}$/.test(value)) {
                return value.slice(6, 8); // "23" for "06/30/23"
              }
              // fallback
              return value;
            }
          }
        },

        },
        yAxis: {
          type: 'log',
          name: 'Equity ($)',
          axisLabel: {
            formatter: val => `$${(val/1000).toFixed(0)}k`
          }
        },
        series: [
          {
            name: 'New MR 2025',
            type: 'line',
            data: newmrEquity,
            lineStyle: { width: 2 }
          },
          {
            name: 'SPY Benchmark',
            type: 'line',
            data: spyEquity,
            lineStyle: { width: 2, type: 'dashed' }
          }
        ]
      });

      const statPanel = document.getElementById("statsPanel");
      statPanel.innerHTML = `
        <h3 style="margin-bottom:10px;">ðŸ“Š New MR 2025 Strategy Stats</h3>
        <ul style="list-style:none; padding-left:0;">
          <li><strong>Net Profit:</strong> $${stats.NetProfit}</li>
          <li><strong>Total Trades:</strong> ${stats.Trades}</li>
          <li><strong>Sharpe Ratio:</strong> ${stats.Sharpe}</li>
          <li><strong>MAR Ratio:</strong> ${stats.MAR}</li>
          <li><strong>Max Drawdown:</strong> ${stats.Drawdown}%</li>
          <li><strong>Expectancy per Trade:</strong> ${stats.Expectancy}</li>
          <li><strong>Win %:</strong> ${stats.PctWins}</li>
          <li><strong>Max Exposure:</strong> ${stats.MaxExposure}</li>
        </ul>
      `;
    }
    drawChartAndStats();
  </script>
</body>
</html>
